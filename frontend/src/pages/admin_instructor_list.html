<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instructor Management</title>
    <link rel="stylesheet" href="style_instructor_list.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="container">
        <div class="tabs">
            <div class="tab active" id="instructions-tab" onclick="showTab('instructions')">
                <h3>INSTRUCTIONS</h3>
            </div>
            <div class="tab" id="profile-tab" onclick="showTab('profile')">
                <h3>PROFILE</h3>
            </div>
        </div>

        <!-- INSTRUCTIONS sheet content -->
        <div id="instructions" class="sheet-content">
            <button class="add-btn" onclick="toggleAddInstructor()">+ Add Instructor</button>
            <div id="add-instructor-modal" class="modal" style="display:none;">
                <div class="modal-content">
                    <span class="close-btn" onclick="closeModal()">&times;</span>
                    <h3>Add Instructor</h3>
                    <input type="text" id="new-name" placeholder="Name">
                    <input type="text" id="new-surname" placeholder="Surname">
                    <input type="email" id="new-email" placeholder="Email">
                    <label>
                        <input type="checkbox" id="send-email"> Send email 
                    </label>
                    <button onclick="addInstructor()" class="register-btn">Register</button>
                </div>
            </div>
            <div class="table-container">
                <table id="instructor-table">
                    <thead>
                        <tr>
                            <th onclick="sortTable(0)">Actions</th>
                            <th onclick="sortTable(1)">Surname</th>
                            <th onclick="sortTable(2)">Name</th>
                            <th onclick="sortTable(3)">Email</th>
                        </tr>
                    </thead>
                    <tbody id="instructor-table-body">
                        <!-- Instructor rows will be inserted here dynamically -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- PROFILE sheet content -->
        <div id="profile" class="sheet-content" style="display:none;">
            <p>Click on an instructor's name to view their profile details here.</p>
            <div id="profile-details">
                <!-- Profile details will be shown here dynamically -->
            </div>
        </div>

        <!-- Confirmation Dialog -->
        <div id="confirmation-dialog" style="display: none;">
            <p>Are you sure you want to delete this instructor?</p>
            <button onclick="deleteInstructor()">Yes</button>
            <button onclick="cancelDelete()">No</button>
        </div>
    </div>

    <script>
        // Switch between the INSTRUCTIONS and PROFILE tabs
        function showTab(tabName) {
            document.getElementById("instructions").style.display = "none";
            document.getElementById("profile").style.display = "none";

            document.getElementById("instructions-tab").classList.remove("active");
            document.getElementById("profile-tab").classList.remove("active");

            if (tabName === "instructions") {
                document.getElementById("instructions").style.display = "block";
                document.getElementById("instructions-tab").classList.add("active");
            } else {
                document.getElementById("profile").style.display = "block";
                document.getElementById("profile-tab").classList.add("active");
            }
        }

        // Toggle the Add Instructor modal
        function toggleAddInstructor() {
            let modal = document.getElementById("add-instructor-modal");
            modal.style.display = modal.style.display === "none" ? "block" : "none";
        }

        // Close the modal
        function closeModal() {
            document.getElementById("add-instructor-modal").style.display = "none";
        }

        // Add Instructor
        function addInstructor() {
    let name = document.getElementById("new-name").value;
    let surname = document.getElementById("new-surname").value;
    let email = document.getElementById("new-email").value;
    let sendEmail = document.getElementById("send-email").checked;

    // Pārbaude, vai visi lauki ir aizpildīti
    if (!name || !surname || !email) {
        alert("Lūdzu, aizpildiet visus laukus!");
        return;
    }

    // Pārbaude, vai pasniedzējs jau eksistē
    let tableRows = document.querySelectorAll('#instructor-table-body tr');
    for (let row of tableRows) {
        let existingSurname = row.cells[1].innerText;
        let existingName = row.cells[2].innerText;
        if (existingName === name && existingSurname === surname) {
            alert("Pasniedzējs ar šādu vārdu un uzvārdu jau eksistē");
            return;
        }
    }

    // Pārbaude, vai vārds un uzvārds satur tikai burtus
    const nameRegex = /^[A-Za-z]+$/;
    if (!nameRegex.test(name)) {
        alert("Lūdzu ievadiet tikai burtus vārdā!");
        return;
    }

    if (!nameRegex.test(surname)) {
        alert("Lūdzu ievadiet tikai burtus uzvārdā!");
        return;
    }

    // Pārbaude, vai e-pasta adrese ir derīga
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
        alert("Lūdzu ievadiet pareizu e-pasta adresi");
        return;
    }

    // Ja viss ir pareizi, pievienojam pasniedzēju tabulai
    let tableBody = document.getElementById("instructor-table-body");
    let newRow = tableBody.insertRow();

    let newRowId = tableBody.rows.length;
    newRow.setAttribute('data-id', newRowId);  // Add a unique ID to the row

    newRow.innerHTML =
        `<td>
            <button class="action-btn envelope-btn" data-id="${newRowId}"><i class="fas fa-envelope"></i></button>
            <button class="action-btn edit-btn" data-id="${newRowId}"><i class="fas fa-edit"></i></button>
            <button class="action-btn delete-btn" data-id="${newRowId}"><i class="fas fa-times-circle"></i></button>
            <button class="action-btn invite-btn" data-id="${newRowId}"><i class="fas fa-paper-plane"></i></button>
        </td>
        <td>${surname}</td>
        <td>${name}</td>
        <td>${email}</td>`;

    // Reset form fields after adding
    document.getElementById("new-name").value = '';
    document.getElementById("new-surname").value = '';
    document.getElementById("new-email").value = '';

    // Close the modal
    closeModal();

    var mailString = 'Hello! You have been added as a new instructor.\n Welcome, ';
    if (sendEmail) {
        window.location.href = `mailto:${email}?subject=New Instructor&body=${mailString}${name} ${surname}!`;
    }

    // Rebind event listeners to the new buttons after adding
    addEventListenersToNewRow(newRowId);
}

        // Attach event delegation for dynamic buttons
        document.getElementById('instructor-table-body').addEventListener('click', function(event) {
            const target = event.target;
            const rowId = target.closest('tr')?.getAttribute('data-id'); // Get the row ID from the closest row

            if (!rowId) return; // If there is no rowId, exit early (click not on a valid row)

            if (target.classList.contains('edit-btn')) {
                editInstructor(rowId);
            } else if (target.classList.contains('delete-btn')) {
                confirmDelete(rowId);
            } else if (target.classList.contains('envelope-btn')) {
                const email = target.closest('tr').cells[3].innerText;
                sendEmail(email);
            } else if (target.classList.contains('invite-btn')) {
                const email = target.closest('tr').cells[3].innerText;
                sendInvitation(email);
            }
        });

        // Save edited instructor details
        function saveInstructor(rowId) {
            const row = document.querySelector(`[data-id='${rowId}']`);
            const cells = row.getElementsByTagName("td");

            // Get new values from input fields
            let newSurname = document.getElementById(`edit-surname-${rowId}`).value;
            let newName = document.getElementById(`edit-name-${rowId}`).value;
            let newEmail = document.getElementById(`edit-email-${rowId}`).value;

            // Set new values back to table cells
            cells[1].innerText = newSurname;
            cells[2].innerText = newName;
            cells[3].innerText = newEmail;

            // Restore action buttons without save button
            cells[0].innerHTML = `
                <button class='action-btn envelope-btn' onclick='sendEmail("${newEmail}")'>
                    <i class='fas fa-envelope'></i>
                </button>
                <button class='action-btn edit-btn' onclick='editInstructor("${rowId}")'>
                    <i class='fas fa-edit'></i>
                </button>
                <button class='action-btn delete-btn' onclick='confirmDelete("${rowId}")'>
                    <i class='fas fa-times-circle'></i>
                </button>
                <button class='action-btn invite-btn' onclick='sendInvitation("${newEmail}")'>
                    <i class='fas fa-paper-plane'></i>
                </button>
            `;
        }

        // Trigger edit mode for an instructor's details
        function editInstructor(rowId) {
            const row = document.querySelector(`[data-id='${rowId}']`);
            const cells = row.getElementsByTagName("td");

            // Prevent multiple save buttons
            if (row.querySelector(".save-btn")) return;

            // Get current values
            let surname = cells[1].innerText;
            let name = cells[2].innerText;
            let email = cells[3].innerText;

            // Replace content with input fields
            cells[1].innerHTML = `<input type='text' id='edit-surname-${rowId}' value='${surname}'>`;
            cells[2].innerHTML = `<input type='text' id='edit-name-${rowId}' value='${name}'>`;
            cells[3].innerHTML = `<input type='text' id='edit-email-${rowId}' value='${email}'>`;

            // Add save button next to existing buttons
            let actionButtons = cells[0].innerHTML;
            cells[0].innerHTML = `
                ${actionButtons}
                <button class='action-btn save-btn' onclick='saveInstructor("${rowId}")'>
                    Save
                </button>
            `;
        }

        // Sorting function for the table
        function sortTable(columnIndex) {
            const table = document.getElementById("instructor-table");
            const rows = Array.from(table.rows).slice(1);  // Get all rows except the header

            rows.sort((a, b) => {
                const cellA = a.cells[columnIndex].innerText.trim();
                const cellB = b.cells[columnIndex].innerText.trim();
                return cellA.localeCompare(cellB);
            });

            // Reattach sorted rows to the table body
            rows.forEach(row => table.appendChild(row));
        }

        // Send email using the default email client
        function sendEmail(email) {
            window.location.href = `mailto:${email}`;
        }

        // Confirm deletion of an instructor
        function confirmDelete(rowId) {
            document.getElementById("confirmation-dialog").style.display = "flex";
            window.currentRowId = rowId;
        }

        // Delete the instructor
        function deleteInstructor() {
            const row = document.querySelector(`[data-id='${window.currentRowId}']`);
            row.remove();
            document.getElementById("confirmation-dialog").style.display = "none";
        }

        // Cancel delete action
        function cancelDelete() {
            document.getElementById("confirmation-dialog").style.display = "none";
        }

        // Send invitation to instructor (just a mock-up here)
        function sendInvitation(email) {
            alert(`Invitation sent to ${email}`);
        }

        // Rebind event listeners to newly added rows
        function addEventListenersToNewRow(rowId) {
            const row = document.querySelector(`[data-id='${rowId}']`);
            const editButton = row.querySelector('.edit-btn');
            const deleteButton = row.querySelector('.delete-btn');
            const envelopeButton = row.querySelector('.envelope-btn');
            const inviteButton = row.querySelector('.invite-btn');

            editButton.addEventListener('click', () => editInstructor(rowId));
            deleteButton.addEventListener('click', () => confirmDelete(rowId));
            envelopeButton.addEventListener('click', () => sendEmail(row.querySelector('td:nth-child(4)').innerText));
            inviteButton.addEventListener('click', () => sendInvitation(row.querySelector('td:nth-child(4)').innerText));
        }
    </script>
</body>
</html>
